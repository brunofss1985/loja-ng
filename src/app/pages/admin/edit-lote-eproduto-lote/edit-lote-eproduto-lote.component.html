<div class="container py-4">
  <!-- Botão de voltar -->
  <div class="d-flex justify-content-start mb-3">
    <button class="btn btn-outline-secondary btn-sm" (click)="voltar()">
      ← Voltar para Lotes
    </button>
  </div>

  <!-- Accordion do formulário -->
  <div class="accordion mb-4" id="accordionLoteForm">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingForm">
        <button
          class="accordion-button"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapseForm"
          aria-expanded="true"
          aria-controls="collapseForm"
        >
          {{ lote ? 'Editar Lote #' + lote.id : 'Novo Lote' }}
        </button>
      </h2>
      <div
        id="collapseForm"
        class="accordion-collapse collapse"
        aria-labelledby="headingForm"
        data-bs-parent="#accordionLoteForm"
      >
        <div class="accordion-body">
          <div *ngIf="loading" class="text-muted">Carregando...</div>

          <app-lote-form
            *ngIf="!loading"
            [loteToEdit]="lote"
            [quantidadeTotal]="totalQuantidadeProdutosReais"
            (loteSalvo)="onLoteSalvo($event)"
          ></app-lote-form>

          <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-primary btn-sm" (click)="salvar()">
              Salvar Alterações
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção de produtos -->
  <h4 class="mb-2">Produtos Cadastrados neste Lote</h4>
  <h6 class="text-muted mb-3">Total de Produtos no Lote: {{ totalQuantidadeProdutosReais }}</h6>

  <!-- Tabela reutilizável -->
  <app-tables
    [title]="'Produtos Reais do Lote'"
    [rows]="produtosReais"
    [columns]="columnsProdutos"
    [columnLabels]="columnLabelsProdutos"
    [clientSidePagination]="true"
    [sortableColumns]="['id', 'codigoBarras', 'quantidade']"
    [showCreateButton]="true"
    [createButtonLabel]="'Cadastrar Produto Real no Lote'"
    (createButtonClicked)="abrirFormularioProduto()"
    [showActionButtons]="false"
    [currentPage]="currentPage"
    [pageSize]="pageSize"
    (pageChange)="onPageChange($event)"
    (pageSizeChange)="onPageSizeChange($event)"
  ></app-tables>

  <div *ngIf="produtosReais.length === 0" class="text-muted mt-2 text-center">
    Nenhum produto real cadastrado ainda.
  </div>

  <!-- Modal de cadastro de produto real -->
  <ng-container *ngIf="formularioProdutoAberto">
    <div class="modal-backdrop show"></div>
    <div class="modal show d-block" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Cadastrar Produto Real</h5>
            <button
              type="button"
              class="btn-close"
              (click)="formularioProdutoAberto = false"
            ></button>
          </div>

          <app-produto-real-form
            [loteId]="lote?.id!"
            [produtoId]="lote?.produtoId!"
            (produtoSalvo)="salvarProdutoReal($event)"
          ></app-produto-real-form>
        </div>
      </div>
    </div>
  </ng-container>
</div>
<!-- Fim do container principal -->