<form [formGroup]="form" (ngSubmit)="submit()">
  <div class="container-fluid">
    <div class="row">

      <!-- Campos existentes -->

      <div class="col-md-4">
        <label class="mt-2">Código</label>
        <input class="form-control" formControlName="codigo" />
      </div>

      <!-- Produto selecionado (card) -->
      <div class="col-12" *ngIf="selectedProduto" >
        <div class="produto-card">
          <div class="thumb">
            <img [src]="getProdutoImgSrc(selectedProduto)" alt="{{selectedProduto.nome}}" />
          </div>
          <div class="info">
            <div class="title">{{ selectedProduto.nome }}</div>
            <div class="meta">
              <span class="badge">{{ selectedProduto.marca }}</span>
              <span class="badge" *ngIf="selectedProduto.peso">{{ selectedProduto.peso }}</span>
              <span class="badge" *ngIf="selectedProduto.tamanhoPorcao">Porção: {{ selectedProduto.tamanhoPorcao }}</span>
            </div>
          </div>
          <button type="button" class="btn-remover" (click)="limparProduto()">Trocar</button>
        </div>
      </div>

      <!-- Autocomplete de Produto -->
      <div class="col-md-6">
        <label class="mt-2">Produto</label>
        <div class="autocomplete">
     <input class="form-control"
       [value]="selectedProduto?.nome || ''"
       (input)="onProdutoInput($any($event.target).value)"
       (focus)="showSugestoes = true"
                 (blur)="onBlurAutocomplete()"
       placeholder="Busque pelo nome do produto" />
          <ul class="sugestoes" *ngIf="showSugestoes">
            <li *ngIf="buscandoProdutos" class="loading">Buscando...</li>
            <li *ngFor="let p of produtoSugestoes" (click)="selecionarProduto(p)">
              <img class="mini" [src]="getProdutoImgSrc(p)" alt="{{p.nome}}" />
              <span class="nome">{{ p.nome }}</span>
              <span class="aux">• {{ p.marca }}</span>
            </li>
            <li *ngIf="!buscandoProdutos && produtoSugestoes.length === 0" class="empty">Sem resultados</li>
          </ul>
        </div>
        <!-- Campo oculto que mantém o produtoId no form -->
        <input type="hidden" formControlName="produtoId" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Data de Validade</label>
        <input class="form-control" formControlName="dataValidade" type="date" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Fornecedor</label>
        <input class="form-control" formControlName="fornecedor" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Contato Vendedor</label>
        <input class="form-control" formControlName="contatoVendedor" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Custo por Unidade</label>
        <input class="form-control" formControlName="custoPorUnidade" type="number" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Valor de Venda Sugerido</label>
        <input class="form-control" formControlName="valorVendaSugerido" type="number" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Nota Fiscal de Entrada</label>
        <input class="form-control" formControlName="notaFiscalEntrada" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Local Armazenamento</label>
        <input class="form-control" formControlName="localArmazenamento" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Status do Lote</label>
        <select class="form-control" formControlName="statusLote">
          <option value="ativo">Ativo</option>
          <option value="inativo">Inativo</option>
          <option value="em_transito">Em Trânsito</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="mt-2">Data de Recebimento</label>
        <input class="form-control" formControlName="dataRecebimento" type="date" />
      </div>

      <!-- Campo somente leitura -->
      <div class="col-md-4">
        <label class="mt-2">Total de Produtos Reais</label>
        <input class="form-control" [value]="quantidadeTotal" disabled />
      </div>

      <!-- Novos campos -->

      <div class="col-md-4">
        <label class="mt-2">Código de Barras</label>
        <input class="form-control" formControlName="codigoBarras" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">CNPJ Fornecedor</label>
        <input class="form-control" formControlName="cnpjFornecedor" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Custo Total do Lote</label>
        <input class="form-control" formControlName="custoTotal" type="number" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Lucro Total Estimado</label>
        <input class="form-control" formControlName="lucroTotalEstimado" type="number" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Lucro por Unidade</label>
        <input class="form-control" formControlName="lucroEstimadoPorUnidade" type="number" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Data de Cadastro</label>
        <input class="form-control" formControlName="dataCadastro" type="date" />
      </div>

      <div class="col-md-4">
        <label class="mt-2">Data de Atualização</label>
        <input class="form-control" formControlName="dataAtualizacao" type="date" />
      </div>
    </div>
  </div>
</form>
