<div class="chat-widget">
  <!-- Chat Button -->
  <button *ngIf="!isOpen" (click)="toggleChat()" class="chat-button" [class.offline]="!isOnline">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
      </path>
    </svg>
    <div class="chat-tooltip">{{ isOnline ? 'Precisa de ajuda? ğŸ’¬' : 'Offline' }}</div>
  </button>

  <!-- Chat Window -->
  <div *ngIf="isOpen" class="chat-window">
    <!-- Header Reorganizado -->
    <div class="chat-header">
      <div class="chat-header-top">
        <span class="chat-avatar">ğŸ¤–</span>
        <div class="chat-header-info">
          <span class="chat-header-title">Assistente IA</span>
        </div>
      </div>
      <div class="chat-header-status">
        <div class="status-indicator" [class.offline]="!isOnline"></div>
        <span>{{ isOnline ? 'Online agora' : 'Offline' }}</span>
      </div>
      <button (click)="toggleChat()" class="chat-close">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div #messagesContainer class="chat-messages">
      <div *ngFor="let message of messages" class="message" 
           [class.user-message]="message.isUser" 
           [class.bot-message]="!message.isUser">
        <div class="message-avatar">{{ message.isUser ? 'ğŸ‘¤' : 'ğŸ¤–' }}</div>
        <div class="message-bubble">
          <p [innerHTML]="message.content"></p>
          <span class="message-time">{{ message.timestamp | date:'HH:mm' }}</span>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div *ngIf="isTyping" class="message bot-message">
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-bubble typing">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" *ngIf="quickActions.length > 0">
      <button *ngFor="let action of quickActions" 
              (click)="sendQuickAction(action)" 
              class="quick-action-btn"
              [disabled]="!isOnline">
        {{ action.label }}
      </button>
    </div>

    <!-- Input -->
    <div class="chat-input">
      <input #messageInput 
             [(ngModel)]="currentMessage" 
             (keypress)="onKeyPress($event)"
             placeholder="Digite sua pergunta..." 
             class="message-input" 
             [disabled]="!isOnline">
      <button (click)="sendMessage()" 
              class="send-button" 
              [disabled]="!currentMessage.trim() || !isOnline">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
        </svg>
      </button>
    </div>
  </div>
</div>