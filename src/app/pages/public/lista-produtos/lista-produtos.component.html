<div class="main-container" [ngClass]="{ 'column-layout': isMobile }">

  <!-- TELAS MENORES -->
  <ng-container *ngIf="isMobile; else desktopLayout">
    <div class="filters-and-sort d-flex gap-3 mb-3">
      <app-filtro (filtersChanged)="onFiltersChanged($event)"></app-filtro>

      <div class="product-header-sort">
        <label for="sort-select">Ordenar por:</label>
        <select id="sort-select" class="form-select" [(ngModel)]="ordenacaoSelecionada" (change)="onSortChanged()">
          <option *ngFor="let opcao of opcoesOrdenacao" [ngValue]="opcao.valor">
            {{ opcao.nome }}
          </option>
        </select>

        <label for="size-select" class="ms-3">Exibir:</label>
        <select id="size-select" class="form-select" [(ngModel)]="pageSize" (change)="onPageSizeChanged()">
          <option *ngFor="let opcao of opcoesTamanhoPagina" [ngValue]="opcao.valor">
            {{ opcao.nome }}
          </option>
        </select>
      </div>
    </div>

    <div class="products-and-pagination-container">
      <ng-container *ngIf="produtos && produtos.length > 0; else noProductsMobile">
        <div class="product-cards-container">
          <app-product-card *ngFor="let produto of produtos"
            [productId]="produto.id"
            [productNome]="produto.nome"
            [productModelo]="produto.descricaoCurta"
            [productPeso]="produto.peso + 'g'"
            [productImage]="'data:' + produto.imagemMimeType + ';base64,' + produto.imagemBase64"
            [productPreco]="produto.preco"
            [productMarca]="produto.marca"
            [productPrecoDesconto]="produto.precoDesconto"
            [productPorcentagemDesconto]="produto.porcentagemDesconto"
            [productDisponibilidade]="produto.disponibilidade"
            [productImagemMimeType]="produto.imagemMimeType"
            [productImagemBase64]="produto.imagemBase64">
          </app-product-card>
        </div>

        <div class="pagination">
          <div class="d-flex justify-content-center align-items-center mt-4">
            <button class="btn btn-outline-secondary me-2" (click)="paginaAnterior()" [disabled]="currentPage === 0">
              Anterior
            </button>

            <ng-container *ngFor="let page of getPages()">
              <button class="btn mx-1"
                [ngClass]="{'btn-primary': currentPage === page, 'btn-outline-secondary': currentPage !== page}"
                (click)="goToPage(page)">
                {{ page + 1 }}
              </button>
            </ng-container>

            <button class="btn btn-outline-secondary ms-2" (click)="proximaPagina()"
              [disabled]="currentPage >= totalPages - 1">
              Próxima
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #noProductsMobile>
        <div class="full-height-message-container">
          <div class="empty-list-message">
            <h4>Nenhum produto encontrado.</h4>
            <p>Verifique o estoque ou adicione novos produtos.</p>
          </div>
        </div>
      </ng-template>
    </div>
  </ng-container>

  <!-- TELAS MAIORES -->
  <ng-template #desktopLayout>
    <app-filtro class="filter-container" (filtersChanged)="onFiltersChanged($event)"></app-filtro>

    <div class="products-and-pagination-container">
      <div class="product-header-sort">
        <label for="sort-select">Ordenar por:</label>
        <select id="sort-select" class="form-select" [(ngModel)]="ordenacaoSelecionada" (change)="onSortChanged()">
          <option *ngFor="let opcao of opcoesOrdenacao" [ngValue]="opcao.valor">
            {{ opcao.nome }}
          </option>
        </select>

        <label for="size-select" class="ms-3">Exibir:</label>
        <select id="size-select" class="form-select" [(ngModel)]="pageSize" (change)="onPageSizeChanged()">
          <option *ngFor="let opcao of opcoesTamanhoPagina" [ngValue]="opcao.valor">
            {{ opcao.nome }}
          </option>
        </select>
      </div>

      <ng-container *ngIf="produtos && produtos.length > 0; else noProductsDesktop">
        <div class="product-cards-container">
          <app-product-card *ngFor="let produto of produtos"
            [productId]="produto.id"
            [productNome]="produto.nome"
            [productModelo]="produto.descricaoCurta"
            [productPeso]="produto.peso + 'g'"
            [productImage]="'data:' + produto.imagemMimeType + ';base64,' + produto.imagemBase64"
            [productPreco]="produto.preco"
            [productMarca]="produto.marca"
            [productPrecoDesconto]="produto.precoDesconto"
            [productPorcentagemDesconto]="produto.porcentagemDesconto"
            [productDisponibilidade]="produto.disponibilidade"
            [productImagemMimeType]="produto.imagemMimeType"
            [productImagemBase64]="produto.imagemBase64">
          </app-product-card>
        </div>

        <div class="pagination">
          <div class="d-flex justify-content-center align-items-center mt-4">
            <button class="btn btn-outline-secondary me-2" (click)="paginaAnterior()" [disabled]="currentPage === 0">
              Anterior
            </button>

            <ng-container *ngFor="let page of getPages()">
              <button class="btn mx-1"
                [ngClass]="{'btn-primary': currentPage === page, 'btn-outline-secondary': currentPage !== page}"
                (click)="goToPage(page)">
                {{ page + 1 }}
              </button>
            </ng-container>

            <button class="btn btn-outline-secondary ms-2" (click)="proximaPagina()"
              [disabled]="currentPage >= totalPages - 1">
              Próxima
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #noProductsDesktop>
        <div class="full-height-message-container">
          <div class="empty-list-message">
            <h4>Nenhum produto encontrado.</h4>
            <p>Verifique o estoque ou adicione novos produtos.</p>
          </div>
        </div>
      </ng-template>
    </div>
  </ng-template>
</div>
